<!-- Paul Scotti 2021 -->
<!-- Set code as .html file -->
<html>

<!-- Preload javascript and css files -->

<head>
  <script>
    const numStudy = 200; // 100;
    const numPractice = -1; // no practice
    const numTest = 400; // 200;
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <script src="https://maxceylab.github.io/expts/js_code/jquery.min.js"></script>
  <script src="https://maxceylab.github.io/expts/js_code/seedrandom.js"></script>
  <!-- <script src="https://paulscotti.github.io/mturk/Cont_LTM_101_files/TimTurkTools.js"></script> -->
  <script src="https://maxceylab.github.io/expts/js_code/chance.js"></script>
  <script>
  // https://websites.psychology.uwa.edu.au/school/MRCDatabase/uwa_mrc.htm
  // # letters 4-6; min written frequency = 40; min familiarity 500; min concreteness 500 (similar to Taylor & Hamm 2015)
  wordlist=["ANIMAL", "ARMY", "ARTIST", "AUTHOR", "AVENUE", "BABY", "BACK", "BALL", "BAND", "BANK", "BATTLE", "BEACH", "BEAR", "BILL", "BLOCK", "BLOOD", "BOARD", "BOAT", "BODY", "BOOK", "BOTTLE", "BRAIN", "BREAD", "BRIDGE", "BRUSH", "CAMP", "CASE", "CATTLE", "CELL", "CHAIN", "CHAIR", "CHEST", "CHILD", "CHINA", "CHURCH", "CIRCLE", "CITY", "CLOTH", "CLUB", "COAST", "COAT", "COFFEE", "COLUMN", "COOK", "CORNER", "COURT", "COUSIN", "COVER", "CROSS", "CROWD", "DANCE", "DATE", "DESK", "DINNER", "DIRT", "DOCTOR", "DOLLAR", "DOOR", "DRESS", "DRINK", "DRIVER", "DUST", "EARTH", "ENGINE", "FACE", "FAMILY", "FARM", "FATHER", "FEET", "FILM", "FIRE", "FLOOR", "FOOD", "FOOT", "FOREST", "GARDEN", "GIRL", "GLASS", "GOLD", "GRASS", "GROUND", "GUARD", "HAIR", "HALL", "HAND", "HEAD", "HEART", "HILL", "HOME", "HORSE", "HOTEL", "HOUSE", "HUMAN", "INDIAN", "IRON", "ISLAND", "JUDGE", "KING", "KNIFE", "LADY", "LAKE", "LAND", "LAWYER", "LEAD", "LETTER", "LIGHT", "LIQUID", "LIQUOR", "MAIL", "MARKET", "MATCH", "MEAT", "METAL", "MILK", "MONEY", "MOON", "MOTHER", "MOTOR", "MOUTH", "MUSCLE", "MUSIC", "NECK", "NOSE", "NOTE", "NOVEL", "OFFICE", "PAGE", "PAPER", "PARK", "PATH", "PEOPLE", "PERSON", "PHONE", "PICK", "PLANE", "PLANT", "POCKET", "POET", "POOL", "POST", "QUEEN", "RADIO", "RAIN", "RECORD", "RING", "RIVER", "ROAD", "ROCK", "ROOF", "ROOM", "ROSE", "SALT", "SCHOOL", "SEAT", "SEED", "SHEET", "SHIP", "SHOP", "SHORE", "SIGN", "SKIN", "SMILE", "SMOKE", "SNAKE", "SNOW", "SOIL", "SONG", "SOUND", "SPOKE", "SPOT", "SPRING", "SQUARE", "STAFF", "STEEL", "STEP", "STONE", "STORE", "STREET", "SUIT", "TABLE", "TEETH", "TEST", "THROAT", "TOOL", "TOWN", "TRAIN", "TREE", "TRUCK", "UNCLE", "VALLEY", "WALL", "WATER", "WEAPON", "WHEEL", "WIFE", "WIND", "WINDOW", "WINE", "WIRE", "WOOD"];
  // wordlist = wordlist.map(name => name.toLowerCase())
  </script>
  <script>
  // let WORKERID = (IsOnTurk()) ? GetWorkerId() : prompt("You don't look like an mTurker! " +
  //   "Enter an ID to save your data with (any number/string will do). Note your id is used to seed the experiment rng:", "workID");
  // let ASSIGNMENTID = (IsOnTurk()) ? GetAssignmentId() : prompt("Set assignment number (doesnt matter for testing):", "assignmentId");
  const startDate = new Date(); const chance1 = Chance(startDate); Math.seedrandom(chance1.seed); // Use current time as the shuffle seed, so you can trace back their trials
  </script>
  <script src="https://maxceylab.github.io/expts/js_code/lodash.core.js">// Allows _clone</script>

  <!-- Preload images -->
  <script src="https://maxceylab.github.io/expts/dfsolo/loadimg.js"></script>
  <script src="https://maxceylab.github.io/expts/dfsolo/initVariables.js"> </script>

  <!-- load Firebase server javascript, we are using it for storage -->
  <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>

  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/dfsolo/contReport.css">
  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/dfsolo/showTrials.css">
  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/dfsolo/experiment.css">

</head>

<body>
  <!-- Consent statement: -->
  <div id="consentDiv"><center><h1>Vanderbilt University Consent to Participate in Research</h1><p><b>This is a consent form for research participation.</b> It contains important information about this study and what to expect if you decide to participate. If any questions arise, please contact scottibrain@gmail.com</p>
    <iframe src="https://maxceylab.github.io/mturk_irb_consent_p1to2.pdf" width="100%" height="500px"></iframe>
    <p><b>Electronic consent:</b> You may print a copy of this consent form for your records. If you wish to continue with the experiment, please click the button below.<br><br><b>Clicking the button below indicates that:</b><br>You have read the above information<br>You are 18 years of age or older<br>You voluntarily agree to participate<br></p><br></center><p style="text-align: center"><a href="javascript:void(0);" onclick="$('#consentDiv').hide();$('#instructions').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="TextButton" style="display: inline;">I consent to participate in this study</a></p>
  </center></div>

  <!-- Instructions page1 -->
  <div id="instructions" style="display:none">
    <center><b>
        <p>This experiment is a memorization task. It will take approximately 1 hour to complete.</p>
      </b></center>
    <br>
    <p style="text-align: center"><a href="javascript:void(0)" onclick="$('#instructions').hide();GetInfo();$('#instructions2').show();$('a#TextButton').hide();ImagesReady();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="TextButton">Next
        (1 of 2)</a></p>
  </div>

  <!-- Instructions page2 -->
  <div id="instructions2" style="display:none">
    <center><b>
        <p>You will be presented with 200 items (100 visual images, 100 verbal words), one at a time, each presented for 2 seconds.</p>
        <p>Memorize these items when presented.</p><br>

        <p align="center"><img src="https://maxceylab.github.io/stimuli/instruction_images/white_grand_piano.jpg" width="200px"></p>
        <p align="center"><img src="https://maxceylab.github.io/stimuli/instruction_images/phone_word.png" width="200px"></p>

        <p>After every item, you will see the word "remember" or the word "forget".</p>
        <p>If "forget" is displayed, this means that you should forget about the previously displayed item.</p>
        <p>If "remember" is displayed, you should retain the previously displayed item in memory. You will later be tested on your memory for this item.</p>

        <p align="center"><img src="https://maxceylab.github.io/stimuli/instruction_images/remember.png" width="350px">
        <img src="https://maxceylab.github.io/stimuli/instruction_images/forget.png" width="350px"></p>

        <p>The rest of the instructions will be provided when relevant via text pop-ups.</p>
      </b></center>
    <br>
    <p style="text-align: center"><a href="javascript:void(0);" onclick="$('#instructions2').hide();document.body.scrollTop = document.documentElement.scrollTop = 0;StartExperiment();" id="TextButton">Start Experiment</a></p>
    <center>
      <p id=loading>Images loading... Please wait a minute or refresh the page.</p>
  </div>

  <!-- Modal Pop-up Box -->
  <div id="openModal" class="modalDialog">
    <div>
      <a href="#close" onclick="modalContinue();" title="Close" class="close">X</a>
      <p id="openModal_text">Hi!</p>
    </div>
  </div>

  <!-- <form name="turkSubmit" id="turkSubmit" action="" method="POST"> -->
  <input type="submit" value="Submit" name="submitButton" id="submitButton" style="display: none"></form>
  <!-- <script>
    let formtxt = "https://www.mturk.com/mturk/externalSubmit?assignmentId="+ASSIGNMENTID+"&foo=bar"
    document.getElementById('turkSubmit').action = formtxt
  </script> -->
    <!-- submit to turk
    https://workersandbox.mturk.com/mturk/externalSubmit
    https://www.mturk.com/mturk/externalSubmit
    -->

  <!-- Screen after submitting expt -->
  <div id="done">
    <center>
      <div id="doneText">
      </div>
      <p></p>
      <div id="botcheck">
      </div>
      <a href="javascript:void(0);" onclick="SaveData()" id="submitForm">Click to Submit</a>
    </center>
  </div>
  <div id="saving">Saving . . .</div>
  </div>

  <!-- Display Object HTML -->
  <div id="showTrial">
    <div id="fixation" style="font-size: 36pt"></div>
    <div id="RemOrForget">+</div>
    <div id="allItems">
      <img id="itemA" src="https://maxceylab.github.io/stimuli/objects/Obj11_11.png" width=300 height=300 style="position:absolute; top:150px; left:150px;"></img>
      <img id="CDitem" src="https://maxceylab.github.io/stimuli/change_detection/CDfix.png" width=600 height=600 style="display:none"></img>
    </div>
    <center>
    <br><br>
    <a href="javascript:void(0);" onclick="SamePress();" id="SameButton" style="position:absolute; bottom:25px; left:200px;">Same</a>
    <a href="javascript:void(0);" onclick="DiffPress();" id="DiffButton" style="position:absolute; bottom:25px; right:200px;">Different</a>
    </center>
    <br><br>
    <a href="javascript:void(0);" onclick="OldUnsure();" class="OldNewButton" id="OldUnsure" style="position:absolute; bottom:100px; left:80px">Old - Remember (Unsure)</a>
    <a href="javascript:void(0);" onclick="OldSure();" class="OldNewButton" id="OldSure" style="position:absolute; bottom:100px; right: 80px;">Old - Remember (Sure)</a>
    <br><br><br>
    <a href="javascript:void(0);" onclick="OldFUnsure();" class="OldNewButton" id="OldFUnsure" style="position:absolute; bottom:50px; left: 100px;">Old - Forget (Unsure)</a>
    <a href="javascript:void(0);" onclick="OldFSure();" class="OldNewButton" id="OldFSure" style="position:absolute; bottom:50px; right: 95px;">Old - Forget (Sure)</a>
    <br><br><br>
    <a href="javascript:void(0);" onclick="NewUnsure();" class="OldNewButton" id="NewUnsure" style="position:absolute; bottom:0px; left: 132px;">New (Unsure)</a>
    <a href="javascript:void(0);" onclick="NewSure();" class="OldNewButton" id="NewSure" style="position:absolute; bottom:0px; right:120px;">New (Sure)</a>
  </div>

  <!-- Initializing JS -->
  <script>
    /* Initialize Firebase */
    const config = {
      apiKey: "AIzaSyB4FT9tacVGSKmDyWf203wy7WeiDYCDEFM",
      authDomain: "maxceylab-25a85.firebaseapp.com",
      databaseURL: "https://maxceylab-25a85.firebaseio.com",
      projectId: "maxceylab-25a85",
      storageBucket: "maxceylab-25a85.appspot.com",
      messagingSenderId: "521427523696"
    };
    firebase.initializeApp(config);

    // /* Disable context/right-click menu */
    document.oncontextmenu = function() {
        return false;
    }

    /* Define more variables */
    let modalClosed = false;
    // const numStudy = 100; // 100;
    // const numPractice = -1; // no practice
    // const numTest = 200; // 200;
    const displayTime = 2000; //2000 ms
    const itiTime = 500; // 500 ms
    const RemForgetTime = 2500; // 2500 ms remember or forget text
    const imgWidth = 300;
    const imgHeight = 300;
    let study_expt_shuffle = chance1.shuffle([Array(100).fill("image"),Array(100).fill("word")].flat());
    let test_expt_shuffle = chance1.shuffle([Array(200).fill("image"),Array(200).fill("word")].flat());
    let expt = study_expt_shuffle[0];
    let expt_log = [];
    let curword = "";
    let curStudy = 0;
    let curPractice = 0;
    let curStudyw = 0;
    let curTestw = 0;
    let curStudyi = 0;
    let curTesti = 0;
    let curTest = 0;
    let RpPlusCnt = 0;
    let RpMinusCnt = 0;
    let NrpCnt = 0;
    let NrpCntw = 0;
    let PracLuresCnt = 0;
    let RpTestLuresCnt = 0;
    let NrpTestLuresCnt = 0;
    let NrpTestLuresCntw = 0;
    let ForgetCnt = 0;
    let ForgetCntw = 0;
    let ForgetLuresCnt = 0;
    let ForgetLuresCntw = 0;
    let PracticeResp = [];
    let PracticeAcc = [];
    let PracticeRT = [];
    let TestResp = [];
    let TestAcc = [];
    let TestRT = [];
    let TestImgs = [];
    let PracImgs = [];
    let StudyImgs = [];
    let targfB = [0,0,0,0];
    let lurefB = [0,0,0,0];
    let targfF = [0,0,0,0];
    let lurefF = [0,0,0,0];
    let wtargfB = [0,0,0,0];
    let wlurefB = [0,0,0,0];
    let wtargfF = [0,0,0,0];
    let wlurefF = [0,0,0,0];
    let now = new Date().getTime(); // used for 5 min filler task
    let now2 = now;
    let curCD = 0;
    let CDaccuracy = [];
    let CDType = [];

    /* Setup reused image variable */
    let imgA = new Image();
    imgA.crossOrigin = "anonymous";

    /* Setup CD images */
    let imgCD = new Image();
    imgCD.crossOrigin = "anonymous";
    imgCD.src = $('#diff1')[0].src;
    let CDfix = new Image();
    CDfix.crossOrigin = "anonymous";
    CDfix.src = $('#CDfix')[0].src;
    let imgCDtest = new Image();
    imgCDtest.crossOrigin = "anonymous";
    imgCDtest.src = $('#diff1t')[0].src;

    /* Setting up image contexts */
    const itemA = document.getElementById("itemA");
    const CDitem = document.getElementById("CDitem");

    function GetInfo() {
      age = prompt('Before we start, can you tell me how old you are (in years)?');

      while (age > 100 || age < 17 || !(age>=18)) {
        age = prompt('Can you tell me how old you are (e.g., 18, not the year you were born)?');
      }

      // if (age > 35) {
      //   $('body').html('<center><b>Unfortunately, this experiment does not allow participants over 35 years old (we separately study older populations).<br><br>Please return this HIT.<br><br>You will not be paid if you try again and change your age.</b></center>');
      // }

      name = prompt("And what is your full name?");

      sex = prompt('And are you male (M), female (F), non-binary (B), or prefer not to answer (NA)?');

      while (!(sex == 'M' || sex == 'F' || sex == 'B' || sex == 'NA' || sex == 'm' || sex == 'f' || sex == 'b' || sex == 'na' || sex == 'female' || sex == 'male' || sex == 'Female' || sex == 'Male')) {
        sex = prompt('Are you male (M), female (F), non-binary (B), or prefer not to answer (NA)? Type one of the options shown in parentheses.');
      }
      if (sex == 'M' || sex == 'm' || sex == 'male' || sex == 'Male') {
        sex = 'm';
      } else if (sex == 'F' || sex == 'f' || sex == 'female' || sex == 'Female') {
        sex = 'f';
      } else if (sex == 'B' || sex == 'b') {
        sex = 'b';
      } else if (sex == 'NA' || sex == 'na') {
        sex = 'na';
      }

      ethnicity = prompt('How do you describe your ethnicity?');
    }

    /* Start Experiment */
    function StartExperiment() {
      // if (IsOnTurk() && IsTurkPreview()) {
      //     alert("Please accept the HIT before continuing.");
      //     return false;
      // }

      // open pop-up:
      modalClosed = false;
      document.getElementById("openModal_text").innerHTML =
        'Experiment will now begin. Good luck! For the next 17 minutes you will be memorizing various images and words.';
      window.location.href = '#openModal';
      checkFlag1();

      function checkFlag1() {
        if (modalClosed == false) {
          window.setTimeout(checkFlag1, 100); /* this checks the flag every 100 milliseconds*/
        } else {
          $('#instructions').hide();
          expt = study_expt_shuffle[0];
          if (expt=='image'){
            curStudyi++;
            curStudy = curStudyi;
          } else {
            curStudyw++;
            curStudy = curStudyw;
          }
          $('#showTrial').show();
          NextStudyTrial();
        }
      }

    }

    /* Study Phase Start */
    function NextStudyTrial() {
      if ((curStudyw+curStudyi) >= numStudy) { // if end of study
        curStudy++;

        now = new Date().getTime();
        now2 = now;
        $('#itemA').hide(); // hide object from last trial
        document.getElementById('fixation').innerHTML = ""; // hide word from last trial
        $('.OldNewButton').hide(); // hide buttons

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'End of Study Phase! <br><br> Before we test your memory for the studied items, we will do a short task. <br><br> You will see an array of colored squares appear for a brief moment. Then, one colored square will be presented. The task is to select whether the colored square is the same color or a different color than it was before.';
        window.location.href = '#openModal';
        checkFlag2();
        return;

        function checkFlag2() {
          if (modalClosed == false) {
            window.setTimeout(checkFlag2, 100); /* this checks the flag every 100 milliseconds*/
          } else {
            RpPlusCnt = 0; //reset counter for RpPlus
            ChangeDetection(); // start Practice Phase
            return; // need return; otherwise the ShowTrial below executes
          }
        }
      } else {
        // Preload the image of next trial
        if (StudyTrialType[curStudy] == 2) { //Nrp
          if (expt=='image'){
            $('#itemA').attr('src', $('#obj' + Nrp[NrpCnt])[0].src);
            if (NrpCnt <= Nrp.length) {
              NrpCnt++;
            }
          } else {
            curword = wordlist[parseInt(Nrp[NrpCntw])]
            if (NrpCntw <= Nrp.length) {
              NrpCntw++;
            }
          }
        } else if (StudyTrialType[curStudy] == 6) { //Forget
          if (expt=='image'){
            $('#itemA').attr('src', $('#obj' + Forget[ForgetCnt])[0].src);
            if (ForgetCnt <= Forget.length) {
              ForgetCnt++;
            }
          } else {
            curword = wordlist[parseInt(Forget[ForgetCntw])]
            if (ForgetCntw <= Forget.length) {
              ForgetCntw++;
            }
          }
        }
        if (expt=='image'){
          StudyImgs.push($('#itemA')[0].src.slice(-9,-4))
        } else {
          StudyImgs.push(curword)
        }
      }

      setTimeout(function() {
        ShowStudy();
      }, itiTime);
    }

    /* Display Object */
    function ShowStudy() {
      document.getElementById('fixation').innerHTML = "";
      if (expt=='word'){
        document.getElementById('fixation').innerHTML = curword;
      } else {
        $('#allItems').css('margin-top', 0);
      }
      setTimeout(function() {
        document.getElementById('fixation').innerHTML = "";
        $('#allItems').css('margin-top', -1000);
        if (StudyTrialType[curStudy] == 6) { //Forget
          document.getElementById('RemOrForget').innerHTML = "Forget";
        } else {
          document.getElementById('RemOrForget').innerHTML = "Remember";
        }
        setTimeout(function() {
          document.getElementById('RemOrForget').innerHTML = "";
          document.getElementById('fixation').innerHTML = "+";
          setTimeout(function() {
            expt = study_expt_shuffle[curStudyi+curStudyw];
            if (expt=='image'){
              curStudyi++;
              curStudy = curStudyi;
            } else {
              curStudyw++;
              curStudy = curStudyw;
            }
            NextStudyTrial();
          }, itiTime);
        }, RemForgetTime);
      }, displayTime);
    }

    /* Display Object & Old/New Judgment */
    function OldNewJudgment() {
      startTrial = new Date().getTime();
      if (expt=='image'){
        $('#allItems').css('margin-top', 0);
      } else {
        document.getElementById('fixation').innerHTML = curword;
      }
      expt_log.push(expt)
      $('.OldNewButton').show(); // show buttons
    }

    /* Filler Start */
    function ChangeDetection() {
      $('#allItems').css('margin-top', 0);
      $('#CDitem').show()
      now2 = new Date().getTime();
      if (now2 < (now + 120000)) { // 300000 for 5 minutes long filler task
        ChangeDetectionTrial();
      } else {
        $('#CDitem').attr('src', CDfix.src); // reset last CD trial to CDfix; make sure all components of CD task are hidden before moving on
        $('#SameButton').hide();
        $('#DiffButton').hide();
        $('#allItems').css('margin-top', -1000); // show object items again and hide them off-screen
        $('#itemA').show();

        Nrp_StudyOrder = Nrp;
        NrpCnt = 0; NrpCntw = 0;
        Nrp = chance1.shuffle(Nrp);
        Forget_StudyOrder = Forget;
        ForgetCnt = 0; ForgetCntw = 0;
        Forget = chance1.shuffle(Forget);

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'Great job! <br><br> We will now test your memory for the initial study items. <br><br> You will see items one at a time and be asked if you have seen the exact same item before. <br><br>If you have not seen the item before, press the <i>new</i> button. <br><br>If you have seen the item before, and it was followed by the instruction to Remember, then press the <i>old-remember</i> button. <br><br>If you have seen the item before, and it was followed by the instruction to Forget, then press the <i>old-forget</i> button. <br><br>We also ask that you inform us how confident you are in your response by selecting "Sure" if you are confident, and "Unsure" if you are not confident.';
        window.location.href = '#openModal';
        $('#CDitem').hide()
        curTestadder();
        checkFlag6();

        function checkFlag6() {
          if (modalClosed == false) {
            window.setTimeout(checkFlag6, 100); /* this checks the flag every 100 milliseconds*/
          } else if (curPractice > numPractice) {
            NextTestTrial();
          } else {
            NextPracTrial();
          }
        }
      }
    }

    // Present CD trial
    function ChangeDetectionTrial() {
      now2 = new Date().getTime();

      if ([0].includes(parseInt(CDSet[curCD].slice(0, 2)))) { // same
        imgCD.src = $('#same' + (curCD % 25 + 1))[0].src; // memory array
        imgCDtest.src = $('#same' + (curCD % 25 + 1) + 't')[0].src; // test array
        CDType.push(0); // record what type of CD trial this was
      } else { //diff
        imgCD.src = $('#diff' + (curCD % 25 + 1))[0].src;
        imgCDtest.src = $('#diff' + (curCD % 25 + 1) + 't')[0].src;
        CDType.push(1);
      }

      $('#CDitem').attr('src', CDfix.src);
      setTimeout(function() { // after 800 ms, show colored memory array
        $('#CDitem').attr('src', imgCD.src);
        setTimeout(function() { // after 500 ms, show fixation again
          $('#CDitem').attr('src', CDfix.src);
          setTimeout(function() { // after 900 ms, show test array
            $('#CDitem').attr('src', imgCDtest.src);
            $('#SameButton').show();
            $('#DiffButton').show();
          }, 900);
        }, 500);
      }, 800);
    }

    // Responses for Change Detection
    function SamePress() {
      if ([0].includes(parseInt(CDSet[curCD].slice(0, 2)))) { // same
        CDaccuracy.push(1);

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'Correct! Keep going!';
        window.location.href = '#openModal';

        checkFlag5();

      } else if ([1].includes(parseInt(CDSet[curCD].slice(0, 2)))) { // diff
        CDaccuracy.push(0);

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'Incorrect...';
        window.location.href = '#openModal';

        checkFlag5();
      }
    }

    function DiffPress() {
      if ([1].includes(parseInt(CDSet[curCD].slice(0, 2)))) { // diff
        CDaccuracy.push(1);

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'Correct! Keep going!';
        window.location.href = '#openModal';

        checkFlag5();
      } else if ([0].includes(parseInt(CDSet[curCD].slice(0, 2)))) { // same
        CDaccuracy.push(0);

        // open pop-up:
        modalClosed = false;
        document.getElementById("openModal_text").innerHTML =
          'Incorrect...';
        window.location.href = '#openModal';

        checkFlag5();
      }
    }

    /* Test Phase Start */
    function NextTestTrial() {
      $('.OldNewButton').hide(); 
      document.getElementById('fixation').innerHTML = "";
      $('#allItems').css('margin-top', -1000);

      // Preload the image of next trial
      if (TestTrialType[curTest] == 2) { //Nrp
        if (expt=='image'){
          $('#itemA').attr('src', $('#obj' + Nrp[NrpCnt])[0].src);
          if (NrpCnt <= Nrp.length) {
            NrpCnt++;
          }
        } else {
          curword = wordlist[parseInt(Nrp[NrpCntw])]
          if (NrpCntw <= Nrp.length) {
            NrpCntw++;
          }
        }
      } else if (TestTrialType[curTest] == 5) { //NrpTestLures
        if (expt=='image'){
          $('#itemA').attr('src', $('#obj' + NrpTestLures[NrpTestLuresCnt])[0].src);
          if (NrpTestLuresCnt <= NrpTestLures.length) {
            NrpTestLuresCnt++;
          }
        } else {
          curword = wordlist[parseInt(NrpTestLures[NrpTestLuresCntw])]
          if (NrpTestLuresCntw <= NrpTestLures.length) {
            NrpTestLuresCntw++;
          }
        }
      } else if (TestTrialType[curTest] == 6) { //Forget
        if (expt=='image') {
          $('#itemA').attr('src', $('#obj' + Forget[ForgetCnt])[0].src);
          if (ForgetCnt <= Forget.length) {
            ForgetCnt++;
          }
        } else {
          curword = wordlist[parseInt(Forget[ForgetCntw])]
          if (ForgetCntw <= Forget.length) {
            ForgetCntw++;
          }
        }
      } else if (TestTrialType[curTest] == 7) { //ForgetLures
        if (expt=='image') {
          $('#itemA').attr('src', $('#obj' + ForgetLures[ForgetLuresCnt])[0].src);
          if (ForgetLuresCnt <= ForgetLures.length) {
            ForgetLuresCnt++;
          }
        } else {
          curword = wordlist[parseInt(ForgetLures[ForgetLuresCntw])]
          if (ForgetLuresCntw <= ForgetLures.length) {
            ForgetLuresCntw++;
          }
        }
      }

      if (expt=='image'){
        TestImgs.push($('#itemA')[0].src.slice(-9,-4))
      } else {
        TestImgs.push(curword)
      }

      setTimeout(function() { // fixation at beginning of trial for itiTime
        if ((curTesti+curTestw) >= numTest) { // if end of test
          $('#itemA').hide(); // hide object from last trial
          document.getElementById('fixation').innerHTML = "";
          $('.OldNewButton').hide(); // hide buttons

          // open pop-up:
          modalClosed = false;
          document.getElementById("openModal_text").innerHTML =
            'End of Experiment!';
          window.location.href = '#openModal';
          checkFlag4();

          function checkFlag4() {
            if (modalClosed == false) {
              window.setTimeout(checkFlag4, 100); /* this checks the flag every 100 milliseconds*/
            } else {
              Done(); // finish up experiment
              return; // need return; otherwise function below executes
            }
          }
        }
        OldNewJudgment();
      }, itiTime);
    }

    function curTestadder() {
      expt = test_expt_shuffle[curTestw+curTesti];
      if (expt=='image'){
        curTesti++;
        curTest = curTesti;
      } else {
        curTestw++;
        curTest = curTestw;
      }
    }

    function NewSure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(3);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(0);
          targfP[3]=targfP[3]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(0);
          targfR[3]=targfR[3]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(0);
          if (expt=='image'){
            targfB[3]=targfB[3]+1;
          }else{
            wtargfB[3]=wtargfB[3]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(1);
          lurefR[3]=lurefR[3]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(1);
          if (expt=='image'){
            lurefB[3]=lurefB[3]+1;
          }else{
            wlurefB[3]=wlurefB[3]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(0);
          if (expt=='image'){
            targfF[3]=targfF[3]+1;
          }else{
            wtargfF[3]=wtargfF[3]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(1);
          if (expt=='image'){
            lurefF[3]=lurefF[3]+1;
          }else{
            wlurefF[3]=wlurefF[3]+1;
          }
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(3);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(0);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(1);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function NewUnsure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(2);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(0);
          targfP[2]=targfP[2]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(0);
          targfR[2]=targfR[2]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(0);
          if (expt=='image'){
            targfB[2]=targfB[2]+1;
          }else{
            wtargfB[2]=wtargfB[2]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(1);
          lurefR[2]=lurefR[2]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(1);
          if (expt=='image'){
            lurefB[2]=lurefB[2]+1;
          }else{
            wlurefB[2]=wlurefB[2]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(0);
          if (expt=='image'){
            targfF[2]=targfF[2]+1;
          }else{
            wtargfF[2]=wtargfF[2]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(1);
          if (expt=='image'){
            lurefF[2]=lurefF[2]+1;
          }else{
            wlurefF[2]=wlurefF[2]+1;
          }
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(2);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(0);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(1);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function OldUnsure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(1);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(1);
          targfP[1]=targfP[1]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(1);
          targfR[1]=targfR[1]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(1);
          if (expt=='image'){
            targfB[1]=targfB[1]+1;
          }else{
            wtargfB[1]=wtargfB[1]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(0);
          lurefR[1]=lurefR[1]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(0);
          if (expt=='image'){
            lurefB[1]=lurefB[1]+1;
          }else{
            wlurefB[1]=wlurefB[1]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(1);
          if (expt=='image'){
            targfF[1]=targfF[1]+1;
          }else{
            wtargfF[1]=wtargfF[1]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(0);
          if (expt=='image'){
            lurefF[1]=lurefF[1]+1;
          }else{
            wlurefF[1]=wlurefF[1]+1;
          }
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(1);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(1);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(0);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function OldSure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(0);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(1);
          targfP[0]=targfP[0]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(1);
          targfR[0]=targfR[0]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(1);
          if (expt=='image'){
            targfB[0]=targfB[0]+1;
          }else{
            wtargfB[0]=wtargfB[0]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(0);
          lurefR[0]=lurefR[0]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(0);
          if (expt=='image'){
            lurefB[0]=lurefB[0]+1;
          }else{
            wlurefB[0]=wlurefB[0]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(1);
          if (expt=='image'){
            targfF[0]=targfF[0]+1;
          }else{
            wtargfF[0]=wtargfF[0]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(0);
          if (expt=='image'){
            lurefF[0]=lurefF[0]+1;
          }else{
            wlurefF[0]=wlurefF[0]+1;
          }
        }

        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(0);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(1);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(0);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function OldFUnsure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(-1);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(0);
          targfP[1]=targfP[1]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(0);
          targfR[1]=targfR[1]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(0);
          if (expt=='image'){
            targfB[1]=targfB[1]+1;
          }else{
            wtargfB[1]=wtargfB[1]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(0);
          lurefR[1]=lurefR[1]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(0);
          if (expt=='image'){
            lurefB[1]=lurefB[1]+1;
          }else{
            wlurefB[1]=wlurefB[1]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(1);
          if (expt=='image'){
            targfF[1]=targfF[1]+1;
          }else{
            wtargfF[1]=wtargfF[1]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(0);
          if (expt=='image'){
            lurefF[1]=lurefF[1]+1;
          }else{
            wlurefF[1]=wlurefF[1]+1;
          }
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(-1);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(0);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(0);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function OldFSure() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(-2);
        if (TestTrialType[curTest] == 0) { //RpPlus / targfP
          TestAcc.push(0);
          targfP[0]=targfP[0]+1;
        } else if (TestTrialType[curTest] == 1) { //RpMinus / targfR
          TestAcc.push(0);
          targfR[0]=targfR[0]+1;
        } else if (TestTrialType[curTest] == 2) { //Nrp / targfB
          TestAcc.push(0);
          if (expt=='image'){
            targfB[0]=targfB[0]+1;
          }else{
            wtargfB[0]=wtargfB[0]+1;
          }
        } else if (TestTrialType[curTest] == 4) { //RpTestLures / lurefR
          TestAcc.push(0);
          lurefR[0]=lurefR[0]+1;
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures / lurefB
          TestAcc.push(0);
          if (expt=='image'){
            lurefB[0]=lurefB[0]+1;
          }else{
            wlurefB[0]=wlurefB[0]+1;
          }
        } else if (TestTrialType[curTest] == 6) { //Forget / targfF
          TestAcc.push(1);
          if (expt=='image'){
            targfF[0]=targfF[0]+1;
          }else{
            wtargfF[0]=wtargfF[0]+1;
          }
        } else if (TestTrialType[curTest] == 7) { //ForgetLures / lurefF
          TestAcc.push(0);
          if (expt=='image'){
            lurefF[0]=lurefF[0]+1;
          }else{
            wlurefF[0]=wlurefF[0]+1;
          }
        }

        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTestadder();
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(-2);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(0);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(0);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    /* Always track mouse */
    let mouseX, mouseY;
    $(function() {
      $(document).bind('mousemove.overall', function(e) {
        mouseX = e.pageX;
        mouseY = e.pageY;
      });
    });

    /* Done with the experiment */
    function Done() {
      // if (TestAcc.reduce(function(p,c,i,a){return p + (c/a.length)},0).toFixed(3)*100 > 65) {
      //   bonus = 1
      // } else {
      //   bonus = 0
      // }
      // calculate their overall accuracy (Practice + Test)
      // const OverallAcc = (((TestAcc.reduce((a, b) => a + b, 0) + PracticeAcc.reduce((a, b) => a + b, 0)) / (TestAcc.length + PracticeAcc.length)) * 100).toFixed(2);
      document.getElementById("doneText").innerHTML = 'Thanks very much for your participation! A few questions before you finish:' + 
        '<br><br><i>When you first studied the items, did you expect that you would be tested on items that were followed by the instruction to Forget?</i><br>' +
        '<br><input type="radio" name="q1" value="0"> No ' +
        '<input type="radio" name="q1" value="1"> Yes' +
        '<br><br><i>What was your strategy when memorizing these items followed by Forget? Did you intentionally ignore the Forget instruction?</i><br>' +
        '<textarea name="comments_strat" id="comments_strat" style="width: 400px; height: 50px"></textarea>' +
        '<br><br>Any comments for us?<br>' +
        '<textarea name="comments" id="comments" style="width: 400px; height: 50px"></textarea><br>';
      document.getElementById("botcheck").innerHTML = '<br><br><br><br><div>Please copy the following red text into the below box to prove that you are not a bot: ' + '<font color="red">3948017561902340535634051</font><br><br>'+
        '<textarea name="bot" id="bot" style="width: 400px; height: 30px"></textarea></div>';
      $('#showTrial').hide();
      $('#done').show();
    }

    var Date_info = startDate.getMonth() + '_' + startDate.getDate() + '_' + startDate.getHours();

    /* What to save and put it on server */
    function SaveData() {
      if ($('#bot').val() == '3948017561902340535634051') {
        radios = document.getElementsByName("q1");
        if (radios[0].checked + radios[1].checked == 0) {
          alert('Please answer post-experiment question.');
        } else {
          $('#done').children().hide();
          $('#done').hide();
          $('#saving').show();
          const endDate = new Date().getTime();
          const d = {
            "name": name,
            "age": age,
            "sex": sex,
            "ethnicity": ethnicity,
            "StartTime": startDate.getTime(),
            "EndTime": endDate,
            "study_expt_shuffle": study_expt_shuffle,
            "test_expt_shuffle": test_expt_shuffle,
            "expt_log": expt_log,
            "wordlist": wordlist,
            "TestResp": TestResp,
            "TestAcc": TestAcc,
            "TestRT": TestRT,
            "NrpCnt": NrpCnt,
            "NrpTestLuresCnt": NrpTestLuresCnt,
            "ForgetCnt": ForgetCnt,
            "ForgetLuresCnt": ForgetLuresCnt,
            "NrpCntw": NrpCntw,
            "NrpTestLuresCntw": NrpTestLuresCntw,
            "ForgetCntw": ForgetCntw,
            "ForgetLuresCntw": ForgetLuresCntw,
            "CDaccuracy": CDaccuracy,
            "Nrp": Nrp,
            "NrpTestLures": NrpTestLures,
            "Forget": Forget,
            "ForgetLures": ForgetLures,
            "Nrp_StudyOrder": Nrp_StudyOrder,
            "Forget_StudyOrder": Forget_StudyOrder,
            "StudyTrialType": StudyTrialType,
            "TestTrialType": TestTrialType,
            "AllImages": AllImages,
            "TestImgs": TestImgs,
            "StudyImgs": StudyImgs,
            "targfB": targfB,
            "lurefB": lurefB,
            "targfF": targfF,
            "lurefF": lurefF,
            "wtargfB": wtargfB,
            "wlurefB": wlurefB,
            "wtargfF": wtargfF,
            "wlurefF": wlurefF,
            "seed": chance1.seed,
            "radio0": radios[0].checked,
            "radio1": radios[1].checked,
            "comments_strat": $('#comments_strat').val(),
            "comments": $('#comments').val()
          };

          /* save JSON to server */
          const blob = new Blob([JSON.stringify(d)], {
            type: "application/json"
          });
          let req = new XMLHttpRequest();
          req.onreadystatechange = () => {
            if (req.readyState == XMLHttpRequest.DONE) {
              console.log(req.responseText);
            }
          };
          req.open("POST", "https://api.jsonbin.io/v3/b", true);
          req.setRequestHeader("Content-Type", "application/json");
          req.setRequestHeader("X-Master-Key", "$2b$10$bx/1giySNtugOA5tf/LBEevdQ2skXRTqsNSxhhtv0VXDUjKm75FhC");
          req.setRequestHeader("X-Collection-Id", "61856572c4eaa14d58468274");
          req.setRequestHeader("X-Bin-Name", name.split(" ").join("") + '.json');
          req.send(blob);

          document.getElementById("saving").innerHTML = "Submitting...";

          /* submit after waiting a few seconds to make sure data got sent */
          setTimeout(function() {
            document.getElementById("saving").innerHTML = "Experiment complete! You may close this window.";
          }, 5000);
        }
      } else {
        alert('Please correctly copy the red numbers into the last text area before submitting (ensure there are no stray spaces surrounding the numbers).')
      }
    }

    /* check all images are loaded before starting */
    function ImagesReady() {
      for (var i = 0; i < AllImages.length; i++) {
          if (!$('#obj' + AllImages[i])[0].complete) {
              var percentage = i * 100.0 / (AllImages.length);
              percentage = percentage.toFixed(0).toString() + ' %';

              document.getElementById("loading").innerHTML =
                'Loading images ... ' + percentage + '<br>If more than a minute elapses, try refreshing page.';
              setTimeout('ImagesReady()', 20);
              return;
          }
      }
      $('#loading').hide();
      $('a#TextButton').show();
    };

    /* running on IE? */
    function isIE() {
      ua = navigator.userAgent;
      var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
      return is_ie;
    }

    $(function() { // check if Safari, IE, mobile
        if (!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)) { // if Safari
            $('body').html('Unfortunately this HIT does not work in Safari. It works in Chrome only. Sorry!');
        } else if (isIE()) { // if IE
            $('body').html('Unfortunately this HIT does not work in Internet Explorer. It works in Chrome only. Sorry!');
        } else if (
            /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i
            .test(navigator.userAgent) ||
            /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
            .test(navigator.userAgent.substr(0, 4))) {
            $('body').html('Unfortunately this HIT does not work on mobile devices. It works on desktop versions of Chrome only. Sorry!'); // dont allow mobile
        } else if (window.chrome !== null && typeof window.chrome !== "undefined" && window.navigator.vendor == "Google Inc."){
        } else {
          $('body').html('Unfortunately this HIT only works on desktop versions of Chrome. If this is a mistake and you are using Chrome, try updating your browser. Sorry!');
        }
    });

    function modalContinue() {
      modalClosed = true;
    }

    function checkFlag5() {
      if (modalClosed == false) {
        window.setTimeout(checkFlag5, 100); /* this checks the flag every 100 milliseconds*/
      } else {
        $('#SameButton').hide();
        $('#DiffButton').hide();
        curCD++;
        ChangeDetection()
      }
    }
  </script>
</body>

</html>
