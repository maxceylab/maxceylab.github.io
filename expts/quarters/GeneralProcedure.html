<!-- Paul Scotti 2019 -->
<!-- Set code as .html file -->
<html>

<!-- Preload javascript and css files -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <script src="https://maxceylab.github.io/expts/js_code/jquery.min.js"></script>
  <script src="https://maxceylab.github.io/expts/js_code/seedrandom.js"></script>
  <script src="https://maxceylab.github.io/expts/js_code/jcanvas.min.js"></script>
  <script src="https://maxceylab.github.io/expts/js_code/chance.js"></script>
  <script>const startDate = new Date().getTime(); const chance1 = Chance(startDate); Math.seedrandom(chance1.seed); // Use current time as the shuffle seed, so you can trace back their trials</script>
  <script src="https://maxceylab.github.io/expts/js_code/lodash.core.js">// Allows _clone</script>

  <!-- Preload images -->
  <script src="https://maxceylab.github.io/expts/quarters/loadimg.js"></script>
  <script src="https://maxceylab.github.io/expts/quarters/initVariables.js"> </script>

  <!-- load Firebase server javascript, we are using it for storage -->
  <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>

  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/quarters/contReport.css">
  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/quarters/showTrials.css">
  <link rel="stylesheet" type="text/css" href="https://maxceylab.github.io/expts/quarters/experiment.css">

</head>

<body>

  <!-- Consent statement -->
  <div id="consentDiv">
    <h1>The Ohio State University Consent to Participate in Research</h1>
    <h2>Study Title: [APPROVED IRB TITLE HERE]</h2>
    <p><b>This is a consent form for research participation.</b> It contains important information about this study and what to expect if you decide to participate.</p>
    <p><b>Your participation is voluntary.</b></p>
    <p>Please consider the information carefully. Feel free to email questions to the researchers before making your decision whether or not to participate. If you decide to participate, you will be asked to click a button below this form.</p>
    <p><b>Purpose:</b> In this experiment, we are interested in understanding how humans are able to control their attention to focus on relevant information, and how attention is related to other cognitive abilities and traits.</p>
    <p><b>Procedures/Tasks:</b> Your participation involves watching various visual events on a computer screen and responding to what you saw. You will be provided with detailed written instructions at the start of each task.</p>
    <p><b>Duration:</b> The experiment is expected to take the duration listed on the next page. You may leave the study at any time. If you decide to stop participating in the study, there will be no penalty to you, and you will not lose
      any benefits to which you are otherwise entitled. Your decision will not affect your future relationship with The Ohio State University.</p>
    <p><b>Risks and Benefits:</b> There is no more risk associated with participation than you would normally encounter while playing a simple video game. Benefits include advancing scientific knowledge, experiencing the research process, and
      learning about attention and cognitive control.</p>
    <p><b>Confidentiality:</b> Only authorized personnel will have access to your data. No identifiable information will be saved.</p>
    <p>The data that you provide in the experiment will be stored temporarily on a secure private online server, then transferred to our secure lab computers. Only select lab personnel who have received training in human subjects protection and
      clearance to handle data for this project will have access to your results. We will work to make sure that no one sees
      your data without approval. But, because we are using the Internet, there is a chance that someone could access your online responses without permission. In some cases, this information could be used to identify you. Your data will be
      protected with a code to reduce the risk that other people can view the responses. However, there are rare instances when the researcher may be required to share personally identifiable information. For example, in response to a
      complaint about the research, officials at The University and/or regulatory oversight government agencies (National Science Foundation) may access research data. The researcher is also required by law to report certain information to
      government and/or law enforcement officials (e.g., threatened violence against self or others, communicable diseases).</p>
    <p><b>Participant Rights:</b> You may refuse to participate in this study without penalty or loss of benefits to which you are otherwise entitled. If you are a student or employee at Ohio State, your decision will not affect your grades or
      employment status.</p>
    <p>If you choose to participate in the study, you may discontinue participation at any time without penalty or loss of benefits. By consenting below, you do not give up any personal legal rights you may have as a participant in this study.</p>
    <p>An Institutional Review Board responsible for human subjects research at The Ohio State University reviewed this research project and found it to be acceptable, according to applicable state and federal regulations and University policies
      designed to protect the rights and welfare of participants in research.</p>
    <p><b>Contacts and Questions:</b> For questions, concerns, or complaints about the study, or you feel you have been harmed as a result of study participation, you may contact Paul Scotti at scotti.5@osu.edu. For questions about your rights
      as a participant in this study or to discuss other study-related concerns or complaints with someone who is not part of the research team, you may contact Ms. Sandra Meadows in the Office of Responsible Research Practices at
      meadows.8@osu.edu.</p>
    <p><b>Electronic consent:</b> You may print a copy of this consent form for your records. If you wish to continue with the experiment, please click the button below.<br>
      <center><b>Clicking the button below indicates that:</b><br>You have read the above information<br>You are 18 years of age or older<br>You voluntarily agree to participate<br>
    </p><br></center>
    <p style="text-align: center"><a href="javascript:void(0);" onclick="$('#consentDiv').hide();$('#instructions').show();document.body.scrollTop = document.documentElement.scrollTop = 0;$('a#TextButton').show()" id="TextButton" style="display: inline;">I
        consent to participate in this study</a></p>
  </div>

  <!-- Instructions page1 -->
  <div id="instructions" style="display: none">
    <center><b>
        <p>This experiment is a memorization task involving visual images. It will take approximately XX minutes to complete.</p>
        <p>Do not complete this experiment more than once, and please refrain from prolonged breaks once the experiment begins.</p>
        <p>Please do not disable the creation of text dialogs as these will be used to relay instructions.</p>
      </b></center>
    <br>
    <p style="text-align: center"><a href="javascript:void(0);" onclick="$('#instructions').hide();$('#instructions2').show();$('a#TextButton').hide();ImagesReady();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="TextButton">Next
        (1 of 2)</a></p>
  </div>

  <!-- Instructions page2 -->
  <div id="instructions2" style="display:none">
    <center><b>
        <p>You will be presented with 72 objects, one at a time, each presented for 5 seconds.</p>
        <p>Study the visual details of these objects for a later memory test.</p><br>

        <p align="center"><img src="https://maxceylab.github.io/stimuli/instruction_images/white_grand_piano.jpg" width="200px"></p>

        <p>Memory for objects will need to be as detailed as "white grand piano", for example, simply memorizing "piano" for the above image would not be helpful during testing.</p><br>
        <p>The rest of the instructions will be provided when relevant via text pop-ups.</p>
      </b></center>
    <br>
    <p style="text-align: center"><a href="javascript:void(0);" onclick="$('#instructions2').hide();StartExperiment();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="TextButton">Start Experiment</a></p>
    <center>
      <p id=loading>Images loading... Please wait.</p>
  </div>

  <!-- Screen after submitting expt -->
  <div id="done">
    <div id="doneText">
    </div>
    <div><center>
    <a href="javascript:void(0);" onclick="SaveData()" id="submitForm">Click to Submit</a>
  </center>
    </div>
  </div>
  <div id="saving">Saving . . .</div>
  </div>

  <!-- Display Object HTML -->
  <div id="showTrial">
    <div id="fixation">+</div>
    <div id="allItems">
      <canvas id="itemA" width=300 height=300 style="position:absolute; top:150px; left:150px;"></canvas>
      <canvas id="CDitem" width=600 height=600></canvas>
    </div><br><br>
    <center>
      <a href="javascript:void(0);" onclick="Old();" id="Old" style="display: hidden;">Old</a>
      <a href="javascript:void(0);" onclick="New();" id="New" style="display: hidden;">New</a>
      <a href="javascript:void(0);" onclick="SamePress();ChangeDetection();" id="SameButton" style="display: hidden;">Same</a>
      <a href="javascript:void(0);" onclick="DiffPress();ChangeDetection();" id="DiffButton" style="display: hidden;">Different</a>
    </center>
  </div>

  <!-- Initializing JS -->
  <script>
    /* Initialize Firebase */
    const config = {
      apiKey: "AIzaSyB4FT9tacVGSKmDyWf203wy7WeiDYCDEFM",
      authDomain: "maxceylab-25a85.firebaseapp.com",
      databaseURL: "https://maxceylab-25a85.firebaseio.com",
      projectId: "maxceylab-25a85",
      storageBucket: "maxceylab-25a85.appspot.com",
      messagingSenderId: "521427523696"
    };
    firebase.initializeApp(config);

    /* Disable context/right-click menu */
    // document.oncontextmenu = function() {
    //     return false;
    // }

    /* Define more variables */
    const numStudy = 3; // 72;
    const numPractice = 5; // 72;
    const numTest = 5; // 144;
    const displayTime = 5000; //in ms
    const itiTime = 500;
    const imgWidth = 300;
    const imgHeight = 300;
    let curStudy = 0;
    let curPractice = 0;
    let curTest = 0;
    let RpPlusCnt = 0;
    let RpMinusCnt = 0;
    let NrpCnt = 0;
    let PracLuresCnt = 0;
    let RpTestLuresCnt = 0;
    let NrpTestLuresCnt = 0;
    let now = new Date().getTime(); // used for 5 min filler task
    let now2 = now;
    let curCD = 0;
    let CDaccuracy = [];
    let CDType = [];
    let PracticeResp = [];
    let PracticeAcc = [];
    let PracticeRT = [];
    let TestResp = [];
    let TestAcc = [];
    let TestRT = [];
    let curQ = 0;
    let QTrial = 0;
    let TestTrialType = [];

    /* Setup reused image variable */
    let imgA = new Image();
    imgA.crossOrigin = "anonymous";

    /* Setup CD images */
    let imgCD = new Image();
    imgCD.crossOrigin = "anonymous";
    imgCD.src = $('#diff1')[0].src;
    let CDfix = new Image();
    CDfix.crossOrigin = "anonymous";
    CDfix.src = $('#CDfix')[0].src;
    let imgCDtest = new Image();
    imgCDtest.crossOrigin = "anonymous";
    imgCDtest.src = $('#diff1t')[0].src;

    /* Setting up canvas contexts */
    const itemA = document.getElementById("itemA");
    const ctxA = itemA.getContext("2d");
    const CDitem = document.getElementById("CDitem");
    const cdctx = CDitem.getContext("2d");

    /* Start Experiment */
    function StartExperiment() {
      age = prompt('Before we start, can you tell me how old you are (in years)?');

      while (!(age > 0)) {
        age = prompt('Can you tell me how old you are (in years)?');
      }

      sex = prompt('And are you male (M), female (F), non-binary (B), or prefer not to answer (NA)?');

      while (!(sex == 'M' || sex == 'F' || sex == 'B' || sex == 'NA' || sex == 'm' || sex == 'f' || sex == 'b' || sex == 'na' || sex == 'female' || sex == 'male' || sex == 'Female' || sex == 'Male')) {
        sex = prompt('Are you male (M), female (F), non-binary (B), or prefer not to answer (NA)? Type one of the options shown in parentheses.');
      }
      if (sex == 'M' || sex == 'm' || sex == 'male' || sex == 'Male') {
        sex = 'm';
      } else if (sex == 'F' || sex == 'f' || sex == 'female' || sex == 'Female') {
        sex = 'f';
      } else if (sex == 'B' || sex == 'b') {
        sex = 'b';
      } else if (sex == 'NA' || sex == 'na') {
        sex = 'na';
      }

      alert('Your subject ID is: ' + chance1.seed +
        '. Hold on to this ID in case you ever need the experimenter to look up your data, or in case technical difficulties arise. Note that your work is only saved at the end of the experiment.')

      // save a file letting me know that someone made it this far
      const blobx = new Blob([JSON.stringify(chance1.seed)], {
        type: "application/json"
      });
      const storageRefx = firebase.storage().ref('started/' + chance1.seed + '.json');
      storageRefx.put(blobx);

      // Preload the image of next trial
      if (StudyTrialType[curStudy] == 0) { //RpPlus
        start(ctxA, 0, 0, imgWidth, imgHeight, RpPlus[RpPlusCnt]); //xcoord, ycoord, width, height, img
      } else if (StudyTrialType[curStudy] == 1) { //RpMinus
        start(ctxA, 0, 0, imgWidth, imgHeight, RpMinus[RpMinusCnt]); //xcoord, ycoord, width, height, img
      } else if (StudyTrialType[curStudy] == 2) { //Nrp
        start(ctxA, 0, 0, imgWidth, imgHeight, Nrp[NrpCnt]); //xcoord, ycoord, width, height, img
      }

      $('#instructions').hide();
      $('#showTrial').show();
      NextStudyTrial();
    }

    /* Study Phase Start */
    function NextStudyTrial() {
      if (curStudy >= numStudy) { // if end of study
        alert("End of Study Phase!");
        RpPlusCnt = 0; //reset counter for RpPlus
        NextPracTrial(); // start Practice Phase
        return; // need return; otherwise the ShowTrial below executes
      }
      ShowStudy();
    }

    /* Display Object */
    function ShowStudy() {
      $('#allItems').css('margin-top', 0);
      setTimeout(function() {
        $('#allItems').css('margin-top', -1000);
        // Preload the image of next trial
        if (StudyTrialType[curStudy] == 0) { //RpPlus
          start(ctxA, 0, 0, imgWidth, imgHeight, RpPlus[RpPlusCnt]); //xcoord, ycoord, width, height, img
          RpPlusCnt++;
        } else if (StudyTrialType[curStudy] == 1) { //RpMinus
          start(ctxA, 0, 0, imgWidth, imgHeight, RpMinus[RpMinusCnt]); //xcoord, ycoord, width, height, img
          RpMinusCnt++;
        } else if (StudyTrialType[curStudy] == 2) { //Nrp
          start(ctxA, 0, 0, imgWidth, imgHeight, Nrp[NrpCnt]); //xcoord, ycoord, width, height, img
          NrpCnt++;
        }
        curStudy++;
        setTimeout(function() {
          NextStudyTrial();
        }, itiTime);
      }, displayTime);
    }

    /* Practice Phase Start */
    function NextPracTrial() {
      $('#allItems').css('margin-top', -1000);
      // Preload the image of next trial
      if (PracTrialType[curPractice] == 0) { //RpPlus
        start(ctxA, 0, 0, imgWidth, imgHeight, RpPlusPrac[RpPlusCnt]); //xcoord, ycoord, width, height, img
        RpPlusCnt++;
      } else if (PracTrialType[curPractice] == 3) { //PracLure
        start(ctxA, 0, 0, imgWidth, imgHeight, PracLures[PracLuresCnt]); //xcoord, ycoord, width, height, img
        PracLuresCnt++;
      }
      setTimeout(function() {
        if (curPractice >= numPractice) { // if end of study
          curPractice++;
          alert("End of Practice Phase!");
          now = new Date().getTime();
          now2 = now;
          confirm(
            'Before we test your memory, please complete a 5-minute change detection task. You will see an array of colored squares appear for a brief moment. Then, one colored square will be presented. The task is to select whether the colored square is the same color or a different color than it was before.'
          );
          $('#itemA').hide(); // hide object from last trial
          $('#Old').hide(); // hide Old button
          $('#New').hide(); // hide New button
          $('#CDitem').show();
          ChangeDetection(); // start filler task
          return; // need return; otherwise function below executes
        }
        OldNewJudgment();
      }, itiTime);
    }

    /* Display Object & Old/New Judgment */
    function OldNewJudgment() {
      startTrial = new Date().getTime();
      $('#allItems').css('margin-top', 0);
      $('#Old').show();
      $('#New').show();
    }

    /* Filler Start */
    function ChangeDetection() {
      $('#allItems').css('margin-top', 0);
      if (now2 < (now + 30)) { // 300000 for 5 minutes long filler task
        ChangeDetectionTrial();
      } else {
        cdctx.drawImage(CDfix, 0, 0, 600, 600); // reset last CD trial to CDfix; make sure all components of CD task are hidden before moving on
        $('#SameButton').hide();
        $('#DiffButton').hide();
        $('#allItems').css('margin-top', -1000); // show object items again and hide them off-screen
        $('#itemA').show();

        confirm('Finished task! On to test phase.');
        RpPlus_StudyOrder = RpPlus;
        RpPlusCnt = 0; //reset counter for RpPlus
        RpPlus = chance1.shuffle(RpPlus); //reshuffle ordering of RpPlus
        RpMinus_StudyOrder = RpMinus;
        RpMinusCnt = 0;
        RpMinus = chance1.shuffle(RpMinus);
        Nrp_StudyOrder = Nrp;
        NrpCnt = 0;
        Nrp = chance1.shuffle(Nrp);
        NextTestTrial();
      }
    }

    // Present CD trial
    function ChangeDetectionTrial() {
      now2 = new Date().getTime();

      if ([0].includes(parseInt(CDSet[curCD].slice(0,2)))) { // same
        imgCD.src = $('#same'+(curCD % 25 + 1))[0].src; // memory array
        imgCDtest.src = $('#same'+(curCD % 25 + 1)+'t')[0].src; // test array
        CDType.push(0); // record what type of CD trial this was
      } else if ([1].includes(parseInt(CDSet[curCD].slice(0,2)))) { //diff
        imgCD.src = $('#diff'+(curCD % 25 + 1))[0].src;
        imgCDtest.src = $('#diff'+(curCD % 25 + 1)+'t')[0].src;
        CDType.push(1);
      }

      cdctx.drawImage(CDfix, 0, 0, 600, 600);
      setTimeout(function() { // after 800 ms, show colored memory array
        cdctx.drawImage(imgCD, 0, 0, 600, 600);
        setTimeout(function() { // after 500 ms, show fixation again
          cdctx.drawImage(CDfix, 0, 0, 600, 600);
          setTimeout(function() { // after 900 ms, show test array
            cdctx.drawImage(imgCDtest, 0, 0, 600, 600);
            $('#SameButton').show();
            $('#DiffButton').show();
          }, 900);
        }, 500);
      }, 800);
    }

    // Responses for Change Detection
    function SamePress() {
      if ([0].includes(parseInt(CDSet[curCD].slice(0,2)))) { // same
        CDaccuracy.push(1);
        alert('Correct! Keep going!');
      } else if ([1].includes(parseInt(CDSet[curCD].slice(0,2)))) { // diff
        CDaccuracy.push(0);
        alert('Incorrect...');
      }
      $('#SameButton').hide();
      $('#DiffButton').hide();
      curCD++;
    }
    function DiffPress() {
      if ([1].includes(parseInt(CDSet[curCD].slice(0,2)))) { // diff
        CDaccuracy.push(1);
        alert('Correct! Keep going!');
      } else if ([0].includes(parseInt(CDSet[curCD].slice(0,2)))) { // same
        CDaccuracy.push(0);
        alert('Incorrect...');
      }
      $('#SameButton').hide();
      $('#DiffButton').hide();
      curCD++;
    }

    /* Test Phase Start */
    function NextTestTrial() {
      $('#allItems').css('margin-top', -1000);

      // Determine quarter array, assumes 144 test trials
      if (curTest <= 36) {
        curQ = Q1; QTrial = curTest;
      } else if (curTest <= 72) {
        curQ = Q2; QTrial = curTest-36;
      } else if (curTest <= 108) {
        curQ = Q3; QTrial = curTest-72;
      } else if (curTest <= 144) {
        curQ = Q4; QTrial = curTest-108;
      }

      // Determine current test trial type
      if (RpCats.includes(parseInt(curQ[QTrial].slice(0,2)))) {
          if (RpPlusExem.includes(parseInt(curQ[QTrial].slice(3,5)))) {
            TestTrialType = TestTrialType.concat(0);
          } else if (RpMinusExem.includes(parseInt(curQ[QTrial].slice(3,5)))) {
            TestTrialType = TestTrialType.concat(1);
          } else if (RpTestLuresExem.includes(parseInt(curQ[QTrial].slice(3,5)))) {
            TestTrialType = TestTrialType.concat(4);
          }
      } else if (NrpCats.includes(parseInt(curQ[QTrial].slice(0,2)))) {
        if (NrpExem.includes(parseInt(curQ[QTrial].slice(3,5)))) {
          TestTrialType = TestTrialType.concat(2);
        } else if (NrpTestLuresExem.includes(parseInt(curQ[QTrial].slice(3,5)))) {
          TestTrialType = TestTrialType.concat(5);
        }
      }

      // Preload the image of next trial; slice(-1) indexes last number in array
      if (TestTrialType.slice(-1) == 0) { //RpPlus
        start(ctxA, 0, 0, imgWidth, imgHeight, curQ[QTrial]); //xcoord, ycoord, width, height, img
        RpPlusCnt++;
      } else if (TestTrialType.slice(-1) == 1) { //RpMinus
        start(ctxA, 0, 0, imgWidth, imgHeight, curQ[QTrial]); //xcoord, ycoord, width, height, img
        RpMinusCnt++;
      } else if (TestTrialType.slice(-1) == 2) { //Nrp
        start(ctxA, 0, 0, imgWidth, imgHeight, curQ[QTrial]); //xcoord, ycoord, width, height, img
        NrpCnt++;
      } else if (TestTrialType.slice(-1) == 4) { //RpTestLures
        start(ctxA, 0, 0, imgWidth, imgHeight, curQ[QTrial]); //xcoord, ycoord, width, height, img
        RpTestLuresCnt++;
      } else if (TestTrialType.slice(-1) == 5) { //NrpTestLures
        start(ctxA, 0, 0, imgWidth, imgHeight, curQ[QTrial]); //xcoord, ycoord, width, height, img
        NrpTestLuresCnt++;
      }

      setTimeout(function() { // fixation at beginning of trial for itiTime
        if (curTest >= numTest) { // if end of study
          alert("End of Experiment!");
          Done(); // finish up experiment
          return; // need return; otherwise function below executes
        }
        OldNewJudgment();
      }, itiTime);
    }

    function New() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(1);
        if (TestTrialType[curTest] == 0) { //RpPlus
          TestAcc.push(0);
        } else if (TestTrialType[curTest] == 1) { //RpMinus
          TestAcc.push(0);
        } else if (TestTrialType[curTest] == 2) { //Nrp
          TestAcc.push(0);
        } else if (TestTrialType[curTest] == 4) { //RpTestLures
          TestAcc.push(1);
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures
          TestAcc.push(1);
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTest++;
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(1);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(0);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(1);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    function Old() {
      if (curPractice > numPractice) { // if test phase
        TestResp.push(0);
        if (TestTrialType[curTest] == 0) { //RpPlus
          TestAcc.push(1);
        } else if (TestTrialType[curTest] == 1) { //RpMinus
          TestAcc.push(1);
        } else if (TestTrialType[curTest] == 2) { //Nrp
          TestAcc.push(1);
        } else if (TestTrialType[curTest] == 4) { //RpTestLures
          TestAcc.push(0);
        } else if (TestTrialType[curTest] == 5) { //NrpTestLures
          TestAcc.push(0);
        }
        TestRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curTest++;
        NextTestTrial();
      } else { // if practice phase
        PracticeResp.push(0);
        if (PracTrialType[curPractice] == 0) { //RpPlus
          PracticeAcc.push(1);
        } else if (PracTrialType[curPractice] == 3) { //PracLure
          PracticeAcc.push(0);
        }
        PracticeRT.push((new Date().getTime() - startTrial)); // time to respond (in ms)
        curPractice++;
        NextPracTrial();
      }
    }

    /* Always track mouse */
    let mouseX, mouseY;
    $(function() {
      $(document).bind('mousemove.overall', function(e) {
        mouseX = e.pageX;
        mouseY = e.pageY;
      });
    });

    /* Done with the experiment*/
    function Done() {
      // calculate their overall accuracy (Practice + Test)
      const OverallAcc = (((TestAcc.reduce((a, b) => a + b, 0) + PracticeAcc.reduce((a, b) => a + b, 0)) / (TestAcc.length + PracticeAcc.length))*100).toFixed(2);
      document.getElementById("doneText").innerHTML = 'Thanks very much for your participation!<br><br>Any comments for us? (What strategy did you use? Any technical difficulties?)<br><br>' + 'Your overall accuracy: ' + OverallAcc + '%<br><br><textarea name="comments" id="comments" style="width: 400px; height: 300px"></textarea><br><br>';
      $('#showTrial').hide();
      $('#done').show();
    }

    /* What to save and put it on server */
    function SaveData() {
      $('#done').children().hide();
      $('#done').hide();
      $('#saving').show();
      const endDate = new Date().getTime();
      const d = {
        "ID": chance1.seed,
        "StartTime": startDate,
        "EndTime": endDate,
        "PracticeResp": PracticeResp,
        "PracticeAcc": PracticeAcc,
        "PracticeRT": PracticeRT,
        "TestResp": TestResp,
        "TestAcc": TestAcc,
        "TestRT": TestRT,
        "RpPlusCnt": RpPlusCnt,
        "RpMinusCnt": RpMinusCnt,
        "NrpCnt": NrpCnt,
        "PracLuresCnt": PracLuresCnt,
        "RpTestLuresCnt": RpTestLuresCnt,
        "NrpTestLuresCnt": NrpTestLuresCnt,
        "CDaccuracy": CDaccuracy,
        "RpCats": RpCats,
        "NrpCats": NrpCats,
        "RpPlusExem": RpPlusExem,
        "RpMinusExem": RpMinusExem,
        "PracLuresExem": PracLuresExem,
        "RpTestLuresExem": RpTestLuresExem,
        "NrpExem": NrpExem,
        "NrpTestLuresExem": NrpTestLuresExem,
        "RpPlus": RpPlus,
        "RpMinus": RpMinus,
        "Nrp": Nrp,
        "PracLures": PracLures,
        "RpTestLures": RpTestLures,
        "NrpTestLures": NrpTestLures,
        "RpPlus_StudyOrder": RpPlus_StudyOrder,
        "RpMinus_StudyOrder": RpMinus_StudyOrder,
        "Nrp_StudyOrder": Nrp_StudyOrder,
        "RpPlus_PracticeOrder": RpPlusPrac,
        "StudyTrialType": StudyTrialType,
        "PracTrialType": PracTrialType,
        "TestTrialType": TestTrialType,
        "RandDispersed": RandDispersed,
        "Q1": Q1,
        "Q2": Q2,
        "Q3": Q3,
        "Q4": Q4,
        "AllImages": AllImages
      };

      /* save to Firebase server */
      const blob = new Blob([JSON.stringify(d)], {
        type: "application/json"
      });
      const storageRef = firebase.storage().ref('Quarters/' + chance1.seed + '.json');
      storageRef.put(blob);

      document.getElementById("saving").innerHTML = "Submitting...";

      /* submit after waiting a few seconds to make sure data got sent */
      setTimeout(function() {
        document.getElementById("saving").innerHTML = "Data saved. Thanks for your participation. You may close this window.";
      }, 3000);
    }

    /* draw images on screen */
    function start(context, initX, initY, imgWidth, imgHeight, image) {
      imgA.src = $('#Obj' + image)[0].src;
      imgA.onload = function() {
        context.drawImage(imgA, initX, initY, imgWidth, imgHeight);
      }
    }

    /*check all images are loaded before starting*/
    function ImagesReady() {
      setTimeout(function() { // dont start the check at the same time as the document is loading
        var totImages = 0;
        var readyLoad = 0;
        while (readyLoad == 0) {
          for (let k = 0; k < AllImages.length; k++) {
            if ($('#Obj' + AllImages[k])[0] != null) {
              if ($('#Obj' + AllImages[k])[0].complete) {
                totImages++;
              }
            }
          }
          if (totImages >= AllImages.length) {
            readyLoad = 1;
          } else {
            totImages = 0;
          }
        }
        $('#loading').hide();
        $('a#TextButton').show();
      }, 3000);
    };

    /* running on IE? */
    function isIE() {
      ua = navigator.userAgent;
      var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
      return is_ie;
    }

    /* check if Safari, IE, or mobile */
    $(function() {
      if (!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)) { // if Safari
        $('body').html('Unfortunately this experiment does not work in Safari. It works in Chrome, Firefox, or Opera. Sorry!');
      } else if (isIE()) { // if IE
        $('body').html('Unfortunately this HIT does not work in Internet Explorer. It works in Chrome, Firefox, or Opera. Sorry!');
      } else if (
        /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i
        .test(navigator.userAgent) ||
        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
        .test(navigator.userAgent.substr(0, 4))) {
        $('body').html('Unfortunately this experiment does not work on mobile devices. It works on desktop versions of Chrome, Firefox, or Opera. Sorry!'); // dont allow mobile
      }
    });
  </script>
</body>

</html>
